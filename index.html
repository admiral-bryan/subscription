<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta description="Saving the internet, one publisher at a time.">
    <link rel="shortcut icon" type="image/png" href="https://bryantobin.com/content/bryan-face-fav.png"/>
    <title>Subscription Testing</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- MVP CSS -->
    <link rel="stylesheet" href="https://unpkg.com/mvp.css">
    <!-- Local Stylesheet -->
    <link rel="stylesheet" href="main.css">
    <script type="text/javascript">!(function(o,n,t){t=o.createElement(n),o=o.getElementsByTagName(n)[0],t.async=1,t.src="https://suddensoda.com/v2hguzJ1Tb73qw4v276K6w6fa_TWV1R7GgMRcXn_tfH3oCONgC_cufq-_iSo9PwBR3cXzUg0j6HpXGzHVJmJ9uQ",o.parentNode.insertBefore(t,o)})(document,"script"),(function(o,n){o[n]=o[n]||function(){(o[n].q=o[n].q||[]).push(arguments)}})(window,"admiral");!(function(c,e,o,t,n){function r(o,t){(function n(){try{return 0<(localStorage.getItem("v4ac1eiZr0")||"").split(",")[4]}catch(o){}return!1})()&&(t=c[e].pubads())&&t.setTargeting("admiral-engaged","true")}(n=c[e]=c[e]||{}).cmd=n.cmd||[],typeof n.pubads===o?r():typeof n.cmd.unshift===o?n.cmd.unshift(r):n.cmd.push(r)})(window,"googletag","function");</script>
    <script src="notibry.js"></script>
</head>
<body>
    <header>
        <nav>
            <a href="https://getadmiral.com"><img src="https://admiralarmada.com/content/adm.svg?text=logo" height="70"></a>
            <ul>
                <li><a href="#" id="textLoginBtn">Login</a></li>
                <li><a href="mailto:bryan@getadmiral.com?Subject=Subscription%20Test">Contact</a></li>
                <li><a id="notificationsBtn">Notifications</a></li>
            </ul>
        </nav>
        <div id="smyrna"></div>
        <div class=""><button id="loginBtn"></button></div>
        <br>
    </header>
    <main>
        <h1>
            <div class="text-center" id="status"></div>
        </h1>
    </main>
    <script>
        var timber = {};
        timber.status = document.querySelector('#status');
        timber.loginBtn = document.querySelector('#loginBtn');
        timber.textLoginBtn = document.querySelector('#textLoginBtn');
        timber.date = new Date();
        timber.date.setTime(timber.date.getTime() + (7*24*60*60*1000));
        timber.utcString = timber.date.toUTCString();
        timber.smyrna = document.querySelector('#smyrna');
        timber.penny = document.createElement('img');
        timber.readCookie = function readCookie(c) {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var keyvalues = cookies[i].split('=');
                var key = keyvalues[0].trim();
                if (c === key) {
                    var value = keyvalues[1].trim();
                    if (value === "1") {
                        timber.setSubscriberVersionSite(timber);
                        timber.removeSmyrna();
                        return;
                    }
                }
                timber.loadSmyrna();
                timber.setNonSubscriberVersionSite(timber);
            }
        }
        timber.setNonSubscriberVersionSite = function setNonSubscriberVersionSite(x) {
            timber.loginBtn.textContent = "Subscribe";
            timber.loginBtn.onclick = () => window.admiral('show','transact.subscribe');
            timber.status.textContent = "No Active Subscription";
        }
        timber.setSubscriberVersionSite = function setSubscriberVersionSite(x) {
            x.status.textContent = "Subscribed Visitor";
            x.loginBtn.textContent = "Manage Account";
            x.loginBtn.onclick = () => { window.admiral('show','transact.manage')};
            x.textLoginBtn.style.display = 'none';
        }
        timber.setCookie = function setCookie() {
            window.admiral('after','measure.detected',function(e){
                if (e.subscribed) {
                    document.cookie = "_tbn=1; expires=" + timber.utcString + "; path=/";
                    window.sessionStorage.setItem('activeSubSession', '1');
                    console.log("Subscribed User");
                    return;
                }
                console.log("Non Subscribed User");
                document.cookie = "_tbn=0; expires=" + timber.utcString + "; path=/";
                window.sessionStorage.setItem('activeSubSession', '0');
            })
        }
        timber.loadSmyrna = function loadSmyrna() {
            if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
                timber.penny.src="https://admiralarmada.com/cookie/content/smyrna-sm.png";
            } else {
                timber.penny.src = "https://admiralarmada.com/cookie/content/smyrna.png";
            }
            timber.smyrna.appendChild(timber.penny);
        }
        timber.removeSmyrna = function removeSmyrna() {
            timber.smyrna.style.display = 'none';
        }
        timber.checkForLoggedIn = function checkForLoggedIn(status) {
            if (status.value) {
                console.log("The visitor has logged in");
                timber.textLoginBtn.style.display = 'none';
                return;
            }
            window.sessionStorage.setItem('activeSubSession','0');
            console.log("The visitor has logged out");
            document.cookie = "_tbn=0; expires=" + timber.utcString + "; path=/";
            parent.location.reload();
        }
        timber.textLoginBtn.addEventListener('click',()=>{
            window.admiral('show','transact.login');
        })
        window.admiral('after','transact.subscribed', function() {
            var activeSubSession = window.sessionStorage.getItem('activeSubSession');
            document.cookie = "_tbn=1; expires=" + timber.utcString + "; path=/";
            timber.setSubscriberVersionSite(timber);
            timber.removeSmyrna();
            console.log("Transact susbcribed fired")
            if (activeSubSession === "1") {
                console.log("Active Sub Session Already Set");
            }
        })
        window.onload = timber.readCookie('_tbn');
        window.onload = timber.setCookie();
        //https://admrl.slack.com/archives/DG5CGLLGH/p1611685727001800
        window.admiral('after','transact.loggedIn',timber.checkForLoggedIn);
    </script>
</body>
</html>

